(function(b){b.fn.extend({simpen:function(a){var l=b(this),m=l.outerWidth(),n=l.outerHeight(),g=b('<div class="simpenEditer"><ul></ul><div class="simpenCenter"></div><iframe class="simpenFrame"></iframe></div>');l.css("display","none").after(g.width(m).height(n));g.find(".simpenFrame").height(g.innerHeight()-g.find("ul").outerHeight(!0));var h="div p ul li h1 h2 h3 h4 h5 h6 img".split(" "),q=n=m="",p=["png","jpg","jpeg","gif","bmp"],r=2E6,t=function(s,c){var a=[],d=s.split(",");b.each(d,function(s,d){-1!==b.inArray(d,c)&&-1===b.inArray(d,a)&&a.push(d)});return a};b.isPlainObject(a)&&(a.elements&&"string"===b.type(a.elements)&&(h=t(a.elements,h)),a.skinPath&&"string"===b.type(a.skinPath)&&(m=a.skinPath),a.cssFile&&"string"===b.type(a.cssFile)&&(n=a.cssFile),a.uploadPath&&"string"===b.type(a.uploadPath)&&(q=a.uploadPath),a.imageTypes&&"string"===b.type(a.imageTypes)&&(p=t(a.imageTypes,p)),a.maxSize&&(r=a.maxSize));g.before('<link rel="stylesheet" type="text/css" href="'+m+'/css/main.css">');var e=g.find(".simpenFrame").contents().find("head").append('<link rel="stylesheet" type="text/css" href="'+n+'">').next("body"),d=e,f=!1,k=function(){var b;d!==e?(d.unwrap(),b=e.html(),d.wrap('<div class="wrap"></div>')):b=e.html();l.val(b)};e.dblclick(function(a){if(f)return!1;if(d===e){if("BODY"===b(a.target).prop("tagName"))return!1;-1!==b.inArray(b(a.target).prop("tagName").toLowerCase(),h)&&(d=b(a.target).wrap('<div class="wrap"></div>').data("isWrap",!0))}else{if(b(a.target).data("isWrap")||"BODY"===b(a.target).prop("tagName"))return d.unwrap().data("isWrap",!1),d=e,!1;if("wrap"===b(a.target).attr("class"))return!1;-1!==b.inArray(b(a.target).prop("tagName").toLowerCase(),h)&&(d.unwrap().data("isWrap",!1),d=b(a.target).wrap('<div class="wrap"></div>').data("isWrap",!0))}});b.each(h,function(a,c){var e=b('<li><a href="#">'+c+"</a></li>");g.find("ul").append(e);"img"===c?function(){var a=b('<div class="simpenBox"><iframe name="simpenUpload" class="simpenUpload"></iframe><form class="simpenForm" action="" method="post" enctype="multipart/form-data" target="simpenUpload"><div class="simpenTitle">Upload Image</div><div class="simpenText"><input type="hidden" name="MAX_FILE_SIZE" value="'+r+'"><input type="file" name="simpenImage"></div><div class="simpenButtons"><div><button type="button" name="ok">OK</button></div><div><button type="button" name="cancel">Cancel</button></div></div></form></div>');g.find(".simpenCenter").append(a);var c=a.find(".simpenForm").attr("action",q);c.find("button[name=ok]").click(function(){var d=c.find("input[name=simpenImage]").val().replace("C:\\fakepath\\","").split(".");if(-1===b.inArray(d[d.length-1],p))return alert("The picture type does not allow."),!1;c.submit();a.fadeOut(200);f=!1}).end().find("button[name=cancel]").click(function(){c.find("input[name=simpenImage]").val("");a.fadeOut(200);f=!1});b.extend({simpenImage:function(a){a=b.parseJSON(a);0===a.error?(d.append('<img src="'+a.src+'">'),k()):alert(a.errorMsg)}});e.click(function(){f||(c.find("input[name=simpenImage]").val(""),a.fadeIn(200),f=!0);return!1})}():e.click(function(){if(f)return!1;d.append("<"+c+"></"+c+">");k();return!1})});(function(){var a=b('<li><a href="#"><i>text</i></a></li>'),c=b('<div class="simpenBox"><div class="simpenTitle">Insert Text</div><div class="simpenText"><textarea name="simpenText"></textarea></div><div class="simpenButtons"><div><button type="button" name="ok">OK</button></div><div><button type="button" name="cancel">Cancel</button></div></div></div>');g.find("ul").append(a).end().find(".simpenCenter").append(c);c.find("button[name=ok]").click(function(){var a=c.find("textarea[name=simpenText]"),e=a.val();d.append(b("<div/>").text(e).html());a.val("");c.fadeOut(200);f=!1;k();return!1}).end().find("button[name=cancel]").click(function(){c.find("textarea[name=simpenText]").val("");c.fadeOut(200);return f=!1});a.click(function(){f||(c.fadeIn(200),f=!0);return!1})})();(function(){var a=b('<li><a href="#"><i>html</i></a></li>'),c=b('<div class="simpenBox"><div class="simpenTitle">Edit Html</div><div class="simpenText"><textarea name="simpenText"></textarea></div><div class="simpenButtons"><div><button type="button" name="ok">OK</button></div><div><button type="button" name="cancel">Cancel</button></div></div></div>');g.find("ul").append(a).end().find(".simpenCenter").append(c);c.find("button[name=ok]").click(function(){var a=c.find("textarea[name=simpenText]"),b=a.val();d.html(b);a.val("");c.fadeOut(200);f=!1;k();return!1}).end().find("button[name=cancel]").click(function(){c.find("textarea[name=simpenText]").val("");c.fadeOut(200);return f=!1});a.click(function(){f||(c.find("textarea[name=simpenText]").val(d.html()),c.fadeIn(200),f=!0);return!1})})();(function(){var a=b('<li><a href="#"><i>remove</i></a></li>');g.find("ul").append(a);a.click(function(){f||d===e||(d.unwrap().remove(),d=e,k());return!1})})()}})})(jQuery);