(function(e){e.fn.extend({simpen:function(t){var n=e(this);var r=n.outerWidth();var i=n.outerHeight();var s=e('<div class="simpenEditer"><ul></ul><div class="simpenCenter"></div><iframe class="simpenFrame"></iframe></div>');n.css("display","none").after(s.width(r).height(i));s.find(".simpenFrame").height(s.innerHeight()-s.find("ul").outerHeight(true));var o=["div","p","ul","li","h1","h2","h3","h4","h5","h6","img"];var u="";var a="";var f="";var l=["png","jpg","jpeg","gif","bmp"];var c=2e6;var h=function(t,n){var r=[];var i=t.split(",");e.each(i,function(t,i){if(e.inArray(i,n)!==-1&&e.inArray(i,r)===-1){r.push(i)}});return r};if(e.isPlainObject(t)){if(t.elements&&e.type(t.elements)==="string"){o=h(t.elements,o)}if(t.skinPath&&e.type(t.skinPath)==="string"){u=t.skinPath}if(t.cssFile&&e.type(t.cssFile)==="string"){a=t.cssFile}if(t.uploadPath&&e.type(t.uploadPath)==="string"){f=t.uploadPath}if(t.imageTypes&&e.type(t.imageTypes)==="string"){l=h(t.imageTypes,l)}if(t.maxSize){c=t.maxSize}}s.before('<link rel="stylesheet" type="text/css" href="'+u+"/css/main.css"+'">');var p=s.find(".simpenFrame").contents().find("head").append('<link rel="stylesheet" type="text/css" href="'+a+'">').next("body");p.html(n.val());var d=p;var v=false;var m=function(){var e;if(d!==p){d.unwrap();e=p.html();d.wrap('<div class="wrap"></div>')}else{e=p.html()}n.val(e)};p.dblclick(function(t){if(v)return false;if(d===p){if(e(t.target).prop("tagName")==="BODY"){return false}else if(e.inArray(e(t.target).prop("tagName").toLowerCase(),o)!==-1){d=e(t.target).wrap('<div class="wrap"></div>').data("isWrap",true)}}else{if(e(t.target).data("isWrap")||e(t.target).prop("tagName")==="BODY"){d.unwrap().data("isWrap",false);d=p;return false}else if(e(t.target).attr("class")==="wrap"){return false}else if(e.inArray(e(t.target).prop("tagName").toLowerCase(),o)!==-1){d.unwrap().data("isWrap",false);d=e(t.target).wrap('<div class="wrap"></div>').data("isWrap",true)}}});e.each(o,function(t,n){var r=e('<li><a href="#">'+n+"</a></li>");s.find("ul").append(r);if(n==="img"){(function(){var t=e('<div class="simpenBox"><iframe name="simpenUpload" class="simpenUpload"></iframe><form class="simpenForm" action="" method="post" enctype="multipart/form-data" target="simpenUpload"><div class="simpenTitle">Upload Image</div><div class="simpenText"><input type="hidden" name="MAX_FILE_SIZE" value="'+c+'"><input type="file" name="simpenImage"></div><div class="simpenButtons"><div><button type="button" name="ok">OK</button></div><div><button type="button" name="cancel">Cancel</button></div></div></form></div>');s.find(".simpenCenter").append(t);var n=t.find(".simpenForm").attr("action",f);n.find("button[name=ok]").click(function(){var r=n.find("input[name=simpenImage]").val().replace("C:\\fakepath\\","");var i=r.split(".");if(e.inArray(i[i.length-1],l)===-1){alert("The picture type does not allow.");return false}n.submit();t.fadeOut(200);v=false}).end().find("button[name=cancel]").click(function(){n.find("input[name=simpenImage]").val("");t.fadeOut(200);v=false});e.extend({simpenImage:function(t){t=e.parseJSON(t);if(t.error===0){var n='<img src="'+t.src+'">';d.append(n);m()}else{alert(t.errorMsg)}}});r.click(function(){if(!v){n.find("input[name=simpenImage]").val("");t.fadeIn(200);v=true}return false})})()}else{r.click(function(){if(v)return false;d.append("<"+n+"></"+n+">");m();return false})}});(function(){var t=e('<li><a href="#"><i>text</i></a></li>');var n=e('<div class="simpenBox"><div class="simpenTitle">Insert Text</div><div class="simpenText"><textarea name="simpenText"></textarea></div><div class="simpenButtons"><div><button type="button" name="ok">OK</button></div><div><button type="button" name="cancel">Cancel</button></div></div></div>');s.find("ul").append(t).end().find(".simpenCenter").append(n);n.find("button[name=ok]").click(function(){var t=n.find("textarea[name=simpenText]");var r=t.val();d.append(e("<div/>").text(r).html());t.val("");n.fadeOut(200);v=false;m();return false}).end().find("button[name=cancel]").click(function(){n.find("textarea[name=simpenText]").val("");n.fadeOut(200);v=false;return false});t.click(function(){if(!v){n.fadeIn(200);v=true}return false})})();(function(){var t=e('<li><a href="#"><i>html</i></a></li>');var n=e('<div class="simpenBox"><div class="simpenTitle">Edit Html</div><div class="simpenText"><textarea name="simpenText"></textarea></div><div class="simpenButtons"><div><button type="button" name="ok">OK</button></div><div><button type="button" name="cancel">Cancel</button></div></div></div>');s.find("ul").append(t).end().find(".simpenCenter").append(n);n.find("button[name=ok]").click(function(){var e=n.find("textarea[name=simpenText]");var t=e.val();d.html(t);e.val("");n.fadeOut(200);v=false;m();return false}).end().find("button[name=cancel]").click(function(){n.find("textarea[name=simpenText]").val("");n.fadeOut(200);v=false;return false});t.click(function(){if(!v){n.find("textarea[name=simpenText]").val(d.html());n.fadeIn(200);v=true}return false})})();(function(){var t=e('<li><a href="#"><i>remove</i></a></li>');s.find("ul").append(t);t.click(function(){if(!v&&d!==p){d.unwrap().remove();d=p;m()}return false})})()}})})(jQuery)